### ============================================
### OpenIddict Authentication Flow Examples
### ============================================

@baseUrl = https://localhost:5219
@tokenEndpoint = {{baseUrl}}/connect/token
@authEndpoint = {{baseUrl}}/connect/authorize
@userinfoEndpoint = {{baseUrl}}/connect/userinfo

### Variables
@username = admin@example.com
@password = Admin@123456
@clientId = postman-client
@clientSecret = postman-secret

### ============================================
### 1. PASSWORD GRANT FLOW (Resource Owner)
### ============================================
### Get access token with username/password
POST {{tokenEndpoint}}
Content-Type: application/x-www-form-urlencoded

grant_type=password
&username={{username}}
&password={{password}}
&scope=openid profile email roles

### ============================================
### 2. PASSWORD GRANT WITH CLIENT CREDENTIALS
### ============================================
POST {{tokenEndpoint}}
Content-Type: application/x-www-form-urlencoded

grant_type=password
&username={{username}}
&password={{password}}
&client_id={{clientId}}
&client_secret={{clientSecret}}
&scope=openid profile email roles api

### ============================================
### 3. CLIENT CREDENTIALS GRANT
### ============================================
### For machine-to-machine authentication
POST {{tokenEndpoint}}
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials
&client_id={{clientId}}
&client_secret={{clientSecret}}
&scope=api

### ============================================
### 4. REFRESH TOKEN
### ============================================
### First, get a token with refresh_token scope
POST {{tokenEndpoint}}
Content-Type: application/x-www-form-urlencoded

grant_type=password
&username={{username}}
&password={{password}}
&scope=openid profile email roles offline_access

### Then use the refresh token (replace YOUR_REFRESH_TOKEN)
# @name refreshToken
POST {{tokenEndpoint}}
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token
&refresh_token=YOUR_REFRESH_TOKEN_HERE
&client_id={{clientId}}
&client_secret={{clientSecret}}

### ============================================
### 5. GET USER INFO
### ============================================
### Use access token from previous requests
GET {{userinfoEndpoint}}
Authorization: Bearer YOUR_ACCESS_TOKEN_HERE

### ============================================
### 6. TOKEN INTROSPECTION
### ============================================
POST {{baseUrl}}/connect/introspect
Content-Type: application/x-www-form-urlencoded

token=YOUR_ACCESS_TOKEN_HERE
&client_id={{clientId}}
&client_secret={{clientSecret}}

### ============================================
### 7. REVOKE TOKEN
### ============================================
POST {{baseUrl}}/connect/revoke
Content-Type: application/x-www-form-urlencoded

token=YOUR_ACCESS_TOKEN_HERE
&client_id={{clientId}}
&client_secret={{clientSecret}}

### ============================================
### 8. LEGACY AUTH CONTROLLER (Validation Only)
### ============================================
### This only validates credentials, use /connect/token instead
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "userNameOrEmail": "{{username}}",
  "password": "{{password}}"
}

### ============================================
### 9. REGISTER NEW USER
### ============================================
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "userName": "testuser",
  "email": "test@example.com",
  "password": "Test@123456",
  "firstName": "Test",
  "lastName": "User"
}

### ============================================
### 10. USE TOKEN TO ACCESS PROTECTED ENDPOINT
### ============================================
GET {{baseUrl}}/api/auth/me
Authorization: Bearer YOUR_ACCESS_TOKEN_HERE

### ============================================
### AUTHORIZATION CODE FLOW (Browser-based)
### ============================================
### Step 1: Direct user to authorization endpoint
### Paste this in browser:
### {{authEndpoint}}?response_type=code&client_id={{clientId}}&redirect_uri=https://oauth.pstmn.io/v1/callback&scope=openid%20profile%20email

### Step 2: After user logs in and authorizes, exchange code for token
# POST {{tokenEndpoint}}
# Content-Type: application/x-www-form-urlencoded
#
# grant_type=authorization_code
# &code=YOUR_AUTHORIZATION_CODE_HERE
# &redirect_uri=https://oauth.pstmn.io/v1/callback
# &client_id={{clientId}}
# &client_secret={{clientSecret}}

### ============================================
### ADMIN ENDPOINTS (Require Admin Role)
### ============================================

### Get all users
GET {{baseUrl}}/api/admin/users
Authorization: Bearer YOUR_ADMIN_ACCESS_TOKEN_HERE

### Get all clients
GET {{baseUrl}}/api/admin/clients
Authorization: Bearer YOUR_ADMIN_ACCESS_TOKEN_HERE

### Get all scopes
GET {{baseUrl}}/api/admin/scopes
Authorization: Bearer YOUR_ADMIN_ACCESS_TOKEN_HERE

### Get all roles
GET {{baseUrl}}/api/admin/roles
Authorization: Bearer YOUR_ADMIN_ACCESS_TOKEN_HERE
